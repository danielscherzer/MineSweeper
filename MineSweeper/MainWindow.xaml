<Window x:Class="MineSweeper.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:MineSweeper"
        mc:Ignorable="d"
        Title="MainWindow" Height="760" Width="800" WindowStartupLocation="CenterScreen">
	<Window.Resources>
		<local:MineSweeperModel x:Key="mineSweeperModel"/>
		<Path x:Key="pathMine" Data="M544,62.289326 L614.71069,133 C592.12293,155.58776 569.53518,178.17552 546.94742,200.76328 561.80952,222.66667 573.42857,238.66667 584.99506,291 617.66337,291 650.33169,291 683,291 L683,391 C650.33169,391 617.66337,391 584.99506,391 575.90476,430.33333 565.22693,453.60104 548.92227,478.35156 548.67033,478.71962 557.70536,465.01786 548.16644,479.45575 571.68119,502.9705 595.19594,526.48525 618.71069,550 L548,620.71069 C524.51169,597.05854 501.02337,573.40639 477.53506,549.75424 456.22321,564.77679 420.42145,579.77429 390.38373,585.9209 L390,585.99442 390,685 290,685 290,585.99442 289.61629,585.9209 C259.57858,579.77429 227.03571,568.36905 200.08333,548.13095 L130,617.71069 59.289318,547 129.85992,476.42938 C105.74071,439.25534 103.75508,432.6967 95.004941,391 L0,391 0,291 C31.670505,291 63.34101,291 95.011515,291 107.5,236.64286 113.92349,230.24669 129.69705,205.76752 L129.72704,205.72271 60.718319,136.714 131.429,66.003323 199.87334,134.20489 C232.92857,110.16667 246.83333,102.7381 289.45695,96.448373 289.45695,64.377282 289,32.071091 289,0 L389,0 389,95.813994 C432.83333,106.2619 451.57143,113.82143 475.38095,130.91667"/>
		<Style x:Key="openBorder" TargetType="Border">
			<Setter Property="BorderThickness" Value="0.2"/>
			<Setter Property="BorderBrush" Value="DarkGray"/>
			<Setter Property="Background" Value="#FFD5D2D2"/>
		</Style>
		<Style x:Key="closedBorder" TargetType="Border">
			<Style.Resources>
				<Color x:Key="background">Silver</Color>
				<SolidColorBrush x:Key="brushBackground" Color="{StaticResource background}"/>
				<LinearGradientBrush x:Key="3dBrush">
					<GradientStop Color="#FFF" Offset="0" />
					<GradientStop Color="#DDD" Offset="0.499" />
					<GradientStop Color="#AAA" Offset="0.501" />
					<GradientStop Color="#888" Offset="1" />
				</LinearGradientBrush>
			</Style.Resources>
			<Setter Property="Background" Value="{StaticResource brushBackground}"/>
			<Setter Property="BorderThickness" Value="3"/>
			<Setter Property="BorderBrush" Value="{StaticResource 3dBrush}"/>
			<EventSetter Event="MouseLeftButtonDown" Handler="OpenCell"/>
			<EventSetter Event="MouseRightButtonDown" Handler="MarkCell"/>
			<Style.Triggers>
				<EventTrigger RoutedEvent="MouseLeftButtonDown">
					<BeginStoryboard>
						<Storyboard>
							<DoubleAnimation To="0" Duration="0:0:1" Storyboard.TargetProperty="Opacity"/>
						</Storyboard>
					</BeginStoryboard>
				</EventTrigger>
				<EventTrigger RoutedEvent="MouseEnter">
					<BeginStoryboard>
						<Storyboard>
							<ColorAnimation To="#B3B3B3" Duration="0:0:0.1" Storyboard.TargetProperty="Background.(SolidColorBrush.Color)"/>
						</Storyboard>
					</BeginStoryboard>
				</EventTrigger>
				<EventTrigger RoutedEvent="MouseLeave">
					<BeginStoryboard>
						<Storyboard>
							<ColorAnimation To="{StaticResource background}" Duration="0:0:0.1" Storyboard.TargetProperty="Background.(SolidColorBrush.Color)"/>
						</Storyboard>
					</BeginStoryboard>
				</EventTrigger>
			</Style.Triggers>
		</Style>

		<DataTemplate x:Key="emptyCell">
			<Border Style="{StaticResource openBorder}"/>
		</DataTemplate>
		<DataTemplate x:Key="mineCell">
			<Border Style="{StaticResource openBorder}">
				<Viewbox>
					<Canvas Width="700" Height="700">
						<Path Fill="Black" Height="414.715" Canvas.Left="144.857" Canvas.Top="143.286" Width="412.622" Stretch="Fill" Data="{Binding Source={StaticResource pathMine}, Path=Data}"/>
					</Canvas>
				</Viewbox>
			</Border>
		</DataTemplate>
		<DataTemplate x:Key="observerCell">
			<Border Style="{StaticResource openBorder}">
				<Viewbox>
					<TextBlock Text="{Binding NeighborMines}" TextAlignment="Center" HorizontalAlignment="Center">
						<TextBlock.Style>
							<Style TargetType="TextBlock">
								<Setter Property="Foreground" Value="Black"/>
								<Style.Triggers>
									<Trigger Property="Text" Value="1">
										<Setter Property="Foreground" Value="Blue"/>
									</Trigger>
									<Trigger Property="Text" Value="2">
										<Setter Property="Foreground" Value="Green"/>
									</Trigger>
									<Trigger Property="Text" Value="3">
										<Setter Property="Foreground" Value="Red"/>
									</Trigger>
									<Trigger Property="Text" Value="4">
										<Setter Property="Foreground" Value="DarkBlue"/>
									</Trigger>
									<Trigger Property="Text" Value="5">
										<Setter Property="Foreground" Value="DarkRed"/>
									</Trigger>
									<Trigger Property="Text" Value="6">
										<Setter Property="Foreground" Value="DarkCyan"/>
									</Trigger>
								</Style.Triggers>
							</Style>
						</TextBlock.Style>
					</TextBlock>
				</Viewbox>
			</Border>
		</DataTemplate>
		<DataTemplate x:Key="closedCell">
			<Border Style="{StaticResource closedBorder}"/>
		</DataTemplate>
		<DataTemplate x:Key="markedCell">
			<Border Style="{StaticResource closedBorder}">
				<Viewbox>
					<Canvas Width="700" Height="700">
						<Path Fill="Snow" Height="414.715" Canvas.Left="144.857" Canvas.Top="143.286" Width="412.622" Stretch="Fill" Data="{Binding Source={StaticResource pathMine}, Path=Data}"/>
					</Canvas>
				</Viewbox>
			</Border>
		</DataTemplate>
		<!--cell style for template selection-->
		<Style x:Key="cell" TargetType="ContentPresenter">
			<Setter Property="ContentTemplate" Value="{StaticResource observerCell}"/>
			<Style.Triggers>
				<DataTrigger Binding="{Binding IsMine}" Value="true">
					<Setter Property="ContentTemplate" Value="{StaticResource mineCell}"/>
				</DataTrigger>
				<DataTrigger Binding="{Binding NeighborMines}" Value="0">
					<Setter Property="ContentTemplate" Value="{StaticResource emptyCell}"/>
				</DataTrigger>
				<DataTrigger Binding="{Binding IsOpen}" Value="false">
					<Setter Property="ContentTemplate" Value="{StaticResource closedCell}"/>
				</DataTrigger>
				<DataTrigger Binding="{Binding IsMarked}" Value="true">
					<Setter Property="ContentTemplate" Value="{StaticResource markedCell}"/>
				</DataTrigger>
			</Style.Triggers>
		</Style>
		<!--grid style data template-->
		<DataTemplate x:Key="gridTemplate">
			<ItemsControl ItemsSource="{Binding}">
				<ItemsControl.ItemTemplate>
					<DataTemplate>
						<ContentPresenter Width="30" Height="30" Content="{Binding}" Style="{StaticResource cell}"/>
					</DataTemplate>
				</ItemsControl.ItemTemplate>
				<ItemsControl.ItemsPanel>
					<ItemsPanelTemplate>
						<StackPanel Orientation="Horizontal"/>
					</ItemsPanelTemplate>
				</ItemsControl.ItemsPanel>
			</ItemsControl>
		</DataTemplate>
	</Window.Resources>
	<!--start visual tree-->
	<Grid Background="DarkGray" DataContext="{DynamicResource mineSweeperModel}">
		<Grid.RowDefinitions>
			<RowDefinition Height="40"/>
			<RowDefinition/>
		</Grid.RowDefinitions>
		<Grid>
			<Grid.ColumnDefinitions>
				<ColumnDefinition/>
				<ColumnDefinition/>
				<ColumnDefinition/>
			</Grid.ColumnDefinitions>
			<Button Content="Restart" Click="Restart"/>
			<Label Grid.Column="1">
				<StackPanel Orientation="Horizontal">
					<!--<Viewbox>
						<Canvas Width="700" Height="700">
							<Path Fill="Snow" Height="414.715" Canvas.Left="144.857" Canvas.Top="143.286" Width="412.622" Stretch="Fill" Data="{Binding Source={StaticResource pathMine}, Path=Data}"/>
						</Canvas>
					</Viewbox>-->
					<TextBlock Text="MinesToMark:"/>
					<TextBlock Text="{Binding MinesToMark}"/>
				</StackPanel>
			</Label>
		</Grid>
		<Viewbox Grid.Row="1">
			<ItemsControl ItemsSource="{Binding MineField}" ItemTemplate="{DynamicResource gridTemplate}" />
		</Viewbox>
		<Viewbox Grid.Row="1">
			<TextBlock Name="won" Background="Purple" Foreground="DeepPink" TextWrapping="Wrap" TextAlignment="Center">
				<TextBlock.Style>
					<Style TargetType="TextBlock">
						<Setter Property="Visibility" Value="Hidden"/>
						<Style.Triggers>
							<DataTrigger Binding="{Binding IsWon}" Value="true">
								<Setter Property="Visibility" Value="Visible"/>
							</DataTrigger>
						</Style.Triggers>
					</Style>
				</TextBlock.Style>
				You won!<LineBreak/>You are so amazing!!!
			</TextBlock>
		</Viewbox>
	</Grid>
</Window>
